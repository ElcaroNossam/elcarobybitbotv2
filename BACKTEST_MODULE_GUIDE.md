# ğŸ§ª ElCaro Backtest Module - Complete Guide

**Last Updated:** December 24, 2025  
**Status:** âœ… Fully Integrated  
**URL:** `https://YOUR-DOMAIN/backtest`

---

## ğŸ¯ Overview

ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ **Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ±ĞµĞ·Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ** Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹ Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼ ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€Ğ¾Ğ¼, Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² Ğ¸ Ñ€ĞµĞ°Ğ»Ñ‚Ğ°Ğ¹Ğ¼ ÑĞ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸ĞµĞ¹.

### ğŸŒŸ Key Features

1. **ğŸ“Š Visual Strategy Builder** - Drag & drop ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹
2. **âš¡ Real-time Backtesting** - ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
3. **ğŸ² Monte Carlo Simulation** - ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ğ¸ÑĞºĞ¾Ğ² Ğ¸ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (1000+ ÑĞ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¹)
4. **ğŸ”§ Parameter Optimization** - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ»ÑƒÑ‡ÑˆĞ¸Ñ… Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
5. **ğŸ“ˆ Walk-Forward Analysis** - Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ overfitting
6. **ğŸ¬ Strategy Replay** - Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ´ĞµĞ»Ğ¾Ğº Ğ¿Ğ¾ Ñ‚Ğ°Ğ¹Ğ¼Ğ»Ğ°Ğ¹Ğ½Ñƒ
7. **ğŸ”´ Live Mode** - Ğ ĞµĞ°Ğ»Ñ‚Ğ°Ğ¹Ğ¼ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼ Ñ€Ñ‹Ğ½ĞºĞµ
8. **ğŸ“¦ Strategy Marketplace** - Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚/ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹

---

## ğŸ—ºï¸ Navigation

### Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ:

1. **Ğ¡ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹:** `/` â†’ Features â†’ "Strategy Backtesting" â†’ "Open Backtester"
2. **Ğ˜Ğ· Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğ°:** `/terminal` â†’ Header â†’ <i class="fas fa-chart-line"></i> (ĞºĞ½Ğ¾Ğ¿ĞºĞ° Backtest)
3. **Ğ˜Ğ· ÑĞºÑ€Ğ¸Ğ½ĞµÑ€Ğ°:** `/screener` â†’ Header â†’ "Backtest"
4. **ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ URL:** `/backtest`

### ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ:

```
Terminal Header:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ElCaro Logo] ... [Backtest] [Screener] [Dashboard] [âš™] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Backtest Header:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ElCaro] [Terminal] [Strategies] [Backtester*] [Market] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Architecture

### Frontend (backtest.html)
```
ğŸ“ /webapp/templates/backtest.html (3610 lines)
â”œâ”€â”€ Header Navigation
â”œâ”€â”€ Sidebar (Strategy Selector)
â”‚   â”œâ”€â”€ Pre-built Strategies
â”‚   â”‚   â”œâ”€â”€ ElCaro AI Strategy
â”‚   â”‚   â”œâ”€â”€ RSI + Bollinger Bands
â”‚   â”‚   â”œâ”€â”€ Trend Following
â”‚   â”‚   â”œâ”€â”€ Mean Reversion
â”‚   â”‚   â”œâ”€â”€ Breakout Hunter
â”‚   â”‚   â””â”€â”€ MACD Crossover
â”‚   â””â”€â”€ Custom Strategies
â”œâ”€â”€ Main Content Area
â”‚   â”œâ”€â”€ Configuration Panel
â”‚   â”‚   â”œâ”€â”€ Symbol Selection
â”‚   â”‚   â”œâ”€â”€ Timeframe (1m â†’ 1d)
â”‚   â”‚   â”œâ”€â”€ Period (Days)
â”‚   â”‚   â”œâ”€â”€ Initial Balance
â”‚   â”‚   â”œâ”€â”€ Risk per Trade
â”‚   â”‚   â”œâ”€â”€ Stop Loss / Take Profit
â”‚   â”‚   â””â”€â”€ Advanced Options
â”‚   â”œâ”€â”€ Action Buttons
â”‚   â”‚   â”œâ”€â”€ Run Backtest
â”‚   â”‚   â”œâ”€â”€ Monte Carlo
â”‚   â”‚   â”œâ”€â”€ Optimize
â”‚   â”‚   â”œâ”€â”€ Quick Compare
â”‚   â”‚   â””â”€â”€ Live Mode
â”‚   â”œâ”€â”€ Results Panel
â”‚   â”‚   â”œâ”€â”€ Summary Stats
â”‚   â”‚   â”œâ”€â”€ Performance Metrics
â”‚   â”‚   â”œâ”€â”€ Equity Curve Chart
â”‚   â”‚   â””â”€â”€ Trade History Table
â”‚   â”œâ”€â”€ Strategy Builder
â”‚   â”‚   â”œâ”€â”€ Entry Conditions (Visual)
â”‚   â”‚   â”œâ”€â”€ Exit Conditions (Visual)
â”‚   â”‚   â”œâ”€â”€ Risk Management
â”‚   â”‚   â””â”€â”€ Filters & Timeframes
â”‚   â””â”€â”€ Advanced Tools
â”‚       â”œâ”€â”€ Walk-Forward Analysis
â”‚       â”œâ”€â”€ Parameter Optimization
â”‚       â””â”€â”€ Correlation Matrix
â””â”€â”€ WebSocket Connection (Live Updates)
```

### Backend APIs

```python
# Backtest API Endpoints
/api/backtest/run                # POST - Run backtest
/api/backtest/optimize            # POST - Optimize parameters
/api/backtest/monte-carlo         # POST - Monte Carlo simulation
/api/backtest/quick-compare       # POST - Quick strategy comparison

# Enhanced Backtest API (V2)
/api/backtest-v2/run              # POST - Advanced backtest with more metrics
/api/backtest-v2/walk-forward     # POST - Walk-forward analysis
/api/backtest-v2/correlation      # POST - Strategy correlation matrix

# Strategy Builder API
/api/strategy-backtest/custom     # POST - Test custom strategy
/api/strategy-backtest/validate   # POST - Validate strategy logic
/api/strategy-backtest/export     # POST - Export strategy JSON
/api/strategy-backtest/import     # POST - Import strategy JSON

# WebSocket Real-time Updates
/ws/backtest/{user_id}            # WebSocket - Live backtest updates
```

---

## ğŸ¨ Visual Strategy Builder

### Entry Conditions (Drag & Drop)

```javascript
// Example: RSI Oversold + Volume Spike
{
  "entry": [
    {
      "indicator": "rsi",
      "comparison": "lt",
      "value": 30,
      "period": 14
    },
    {
      "indicator": "volume",
      "comparison": "gt",
      "value": 150,  // % of average
      "period": 20
    }
  ]
}
```

### Exit Conditions

```javascript
{
  "exit": [
    {
      "indicator": "rsi",
      "comparison": "gt",
      "value": 70
    },
    {
      "type": "trailing_stop",
      "value": 2.0,  // %
      "activation": 1.5  // % profit to activate
    }
  ]
}
```

### Available Indicators (50+)

**Trend:**
- EMA (Exponential Moving Average)
- SMA (Simple Moving Average)
- MACD (Moving Average Convergence Divergence)
- ADX (Average Directional Index)
- SuperTrend
- Parabolic SAR
- Ichimoku Cloud

**Momentum:**
- RSI (Relative Strength Index)
- Stochastic
- CCI (Commodity Channel Index)
- Williams %R
- ROC (Rate of Change)
- MFI (Money Flow Index)

**Volatility:**
- Bollinger Bands
- ATR (Average True Range)
- Keltner Channels
- Donchian Channels

**Volume:**
- Volume Profile
- OBV (On Balance Volume)
- VWAP (Volume Weighted Average Price)
- Volume Spike Detection

**Custom:**
- Price Action Patterns
- Support/Resistance Levels
- Fibonacci Retracements
- Multi-timeframe Confluence

---

## ğŸš€ Quick Start

### 1. Simple Backtest

```javascript
// Frontend JavaScript
async function runSimpleBacktest() {
    const response = await fetch('/api/backtest/run', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            symbol: "BTCUSDT",
            strategy: "elcaro",
            timeframe: "1h",
            days: 30,
            initial_balance: 10000,
            risk_per_trade: 1.0,
            stop_loss: 2.0,
            take_profit: 4.0
        })
    });
    
    const result = await response.json();
    console.log(result);
    // {
    //   "total_pnl": 1250.50,
    //   "win_rate": 65.5,
    //   "total_trades": 42,
    //   "sharpe_ratio": 1.85,
    //   "max_drawdown": -8.5,
    //   "profit_factor": 2.15
    // }
}
```

### 2. Monte Carlo Simulation

```javascript
async function runMonteCarlo() {
    const response = await fetch('/api/backtest/monte-carlo', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            trades: backtest_trades,  // Array of trade results
            simulations: 1000,
            confidence_level: 95
        })
    });
    
    const result = await response.json();
    // {
    //   "expected_return": 12.5,
    //   "worst_case": -5.2,
    //   "best_case": 28.4,
    //   "probability_profit": 87.5,
    //   "var_95": -4.8
    // }
}
```

### 3. Parameter Optimization

```javascript
async function optimizeStrategy() {
    const response = await fetch('/api/backtest/optimize', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            symbol: "ETHUSDT",
            strategy: "rsibboi",
            parameter_grid: {
                rsi_period: [10, 14, 20],
                rsi_oversold: [25, 30, 35],
                rsi_overbought: [65, 70, 75],
                bb_period: [15, 20, 25],
                bb_std: [1.5, 2.0, 2.5]
            },
            metric: "sharpe_ratio"  // or "win_rate", "profit_factor"
        })
    });
    
    const result = await response.json();
    // {
    //   "best_params": {
    //     "rsi_period": 14,
    //     "rsi_oversold": 30,
    //     "rsi_overbought": 70,
    //     "bb_period": 20,
    //     "bb_std": 2.0
    //   },
    //   "best_score": 2.15,
    //   "all_results": [...]
    // }
}
```

---

## ğŸ“Š Performance Metrics

### Backtest Result Structure

```python
{
    # ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
    "total_pnl": 1250.50,           # ĞĞ±Ñ‰Ğ¸Ğ¹ P&L Ğ² USD
    "total_pnl_pct": 12.5,          # P&L Ğ² %
    "win_rate": 65.5,               # % Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹ÑˆĞ½Ñ‹Ñ… ÑĞ´ĞµĞ»Ğ¾Ğº
    "total_trades": 42,             # Ğ’ÑĞµĞ³Ğ¾ ÑĞ´ĞµĞ»Ğ¾Ğº
    "winning_trades": 28,           # Ğ’Ñ‹Ğ¸Ğ³Ñ€Ñ‹ÑˆĞ½Ñ‹Ñ…
    "losing_trades": 14,            # ĞŸÑ€Ğ¾Ğ¸Ğ³Ñ€Ñ‹ÑˆĞ½Ñ‹Ñ…
    
    # Ğ Ğ¸ÑĞº-Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
    "sharpe_ratio": 1.85,           # Sharpe Ratio
    "sortino_ratio": 2.42,          # Sortino Ratio
    "max_drawdown": -8.5,           # ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾ÑĞ°Ğ´ĞºĞ° %
    "max_drawdown_duration": 5,     # Ğ”Ğ½ĞµĞ¹ Ğ² Ğ¿Ñ€Ğ¾ÑĞ°Ğ´ĞºĞµ
    "calmar_ratio": 1.47,           # Calmar Ratio
    
    # ĞŸÑ€Ğ¸Ğ±Ñ‹Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
    "profit_factor": 2.15,          # Profit Factor
    "avg_win": 52.30,               # Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ USD
    "avg_loss": -24.50,             # Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ¸Ğ³Ñ€Ñ‹Ñˆ USD
    "avg_win_pct": 5.2,             # Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ %
    "avg_loss_pct": -2.4,           # Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ¸Ğ³Ñ€Ñ‹Ñˆ %
    "largest_win": 145.80,          # Ğ¡Ğ°Ğ¼Ñ‹Ğ¹ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ
    "largest_loss": -48.20,         # Ğ¡Ğ°Ğ¼Ñ‹Ğ¹ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ¸Ğ³Ñ€Ñ‹Ñˆ
    
    # Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
    "avg_trade_duration": 4.2,      # Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ (Ñ‡Ğ°ÑÑ‹)
    "avg_bars_in_trade": 3.5,       # Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ (Ğ±Ğ°Ñ€Ñ‹)
    
    # ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
    "max_consecutive_wins": 7,      # ĞœĞ°ĞºÑ ÑĞµÑ€Ğ¸Ñ Ğ¿Ğ¾Ğ±ĞµĞ´
    "max_consecutive_losses": 3,    # ĞœĞ°ĞºÑ ÑĞµÑ€Ğ¸Ñ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑŒ
    
    # Equity curve
    "equity_curve": [10000, 10150, 10280, ...],
    
    # Trade history
    "trades": [
        {
            "entry_time": "2024-01-15 10:30:00",
            "exit_time": "2024-01-15 14:30:00",
            "side": "LONG",
            "entry_price": 42150.50,
            "exit_price": 42580.20,
            "size": 0.5,
            "pnl": 214.85,
            "pnl_pct": 1.02,
            "exit_reason": "take_profit"
        },
        ...
    ]
}
```

---

## ğŸ² Monte Carlo Analysis

### What is Monte Carlo?

Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ 1000+ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞ¾Ğ² ÑĞ´ĞµĞ»Ğ¾Ğº Ğ´Ğ»Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ¸ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸:

```python
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: 
Original trades: [+5%, -2%, +3%, +7%, -1%, +4%]

# Monte Carlo ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ 1000 ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ñ… Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğº:
Sim 1: [+3%, +7%, -2%, +5%, +4%, -1%]  â†’ Result: +16%
Sim 2: [-2%, -1%, +3%, +5%, +7%, +4%]  â†’ Result: +16%
Sim 3: [+7%, +5%, +3%, -2%, +4%, -1%]  â†’ Result: +16%
...
Sim 1000: [-1%, +4%, -2%, +5%, +3%, +7%] â†’ Result: +16%

# ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ²ÑĞµÑ… 1000 ÑĞ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¹:
- Best case: +28.4%
- Worst case: -5.2%
- Average: +12.5%
- Probability of profit: 87.5%
- 95% VaR: -4.8%
```

### Monte Carlo Metrics

```python
{
    "simulations": 1000,
    "confidence_level": 95,
    
    "expected_return": 12.5,        # Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    "median_return": 12.2,          # ĞœĞµĞ´Ğ¸Ğ°Ğ½Ğ°
    "std_deviation": 8.5,           # Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğµ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğµ
    
    "best_case": 28.4,              # Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹
    "worst_case": -5.2,             # Ğ¥ÑƒĞ´ÑˆĞ¸Ğ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹
    
    "probability_profit": 87.5,     # Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸
    "probability_loss": 12.5,       # Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ ÑƒĞ±Ñ‹Ñ‚ĞºĞ°
    
    "var_95": -4.8,                 # Value at Risk (95%)
    "cvar_95": -3.2,                # Conditional VaR
    
    "percentiles": {
        "5": -4.8,
        "25": 6.2,
        "50": 12.2,
        "75": 18.5,
        "95": 24.8
    }
}
```

---

## ğŸ”§ Walk-Forward Optimization

### What is Walk-Forward?

Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ overfitting Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğ° Train/Test Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ñ‹:

```
Timeline: [=============== 365 days ===============]

Window 1:
â”œâ”€ Train: [===== 30 days =====]
â””â”€ Test:                       [= 7 days =]

Window 2:
    â”œâ”€ Train:     [===== 30 days =====]
    â””â”€ Test:                           [= 7 days =]

Window 3:
        â”œâ”€ Train:         [===== 30 days =====]
        â””â”€ Test:                               [= 7 days =]

... (rolling windows)
```

### Walk-Forward Process

```javascript
{
    "train_period": 30,     // Ğ”Ğ½ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ
    "test_period": 7,       // Ğ”Ğ½ĞµĞ¹ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ°
    "step": 7,              // Ğ¨Ğ°Ğ³ ÑĞ´Ğ²Ğ¸Ğ³Ğ° Ğ¾ĞºĞ½Ğ°
    
    "results": [
        {
            "period": 1,
            "train_sharpe": 2.15,
            "test_sharpe": 1.85,    // Ğ”Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ±Ğ»Ğ¸Ğ·Ğ¾Ğº Ğº train
            "overfitting_score": 0.86  // < 0.7 = Ğ¿Ğ»Ğ¾Ñ…Ğ¾
        },
        ...
    ],
    
    "summary": {
        "avg_train_sharpe": 2.10,
        "avg_test_sharpe": 1.75,
        "consistency_score": 0.83,  // > 0.80 = Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾
        "is_overfit": false
    }
}
```

---

## ğŸ¬ Strategy Replay Mode

### Real-time Visualization

```javascript
// Ğ ĞµĞ¶Ğ¸Ğ¼ replay Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ ÑĞ´ĞµĞ»ĞºĞ¸ Ğ¿Ğ¾ Ñ‚Ğ°Ğ¹Ğ¼Ğ»Ğ°Ğ¹Ğ½Ñƒ
// Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ĞµĞ¼ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸ (0.5x, 1x, 2x, 5x)

const replay = {
    candles: historical_data,
    trades: backtest_trades,
    speed: 1.0,
    
    async play() {
        for (let i = 0; i < this.candles.length; i++) {
            // Update chart
            updateChart(this.candles[i]);
            
            // Check for trades
            const trade = this.trades.find(t => t.index === i);
            if (trade) {
                showTradeMarker(trade);
                animateTradeExecution(trade);
            }
            
            // Wait based on speed
            await sleep(1000 / this.speed);
        }
    }
};
```

---

## ğŸ”´ Live Mode

### Real-time Strategy Execution

```javascript
// Live mode Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğº Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼ Ñ€Ñ‹Ğ½Ğ¾Ñ‡Ğ½Ñ‹Ğ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼
// Ğ¸ ÑĞ¸Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ´ĞµĞ»ĞºĞ¸ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸

const liveMode = {
    ws: null,
    strategy: selected_strategy,
    paper_balance: 10000,
    
    async start() {
        // Connect to market WebSocket
        this.ws = new WebSocket('/ws/market/BTCUSDT');
        
        this.ws.onmessage = (event) => {
            const candle = JSON.parse(event.data);
            
            // Run strategy on new candle
            const signal = this.strategy.evaluate(candle);
            
            if (signal === 'BUY') {
                this.executePaperTrade('LONG', candle.close);
            } else if (signal === 'SELL') {
                this.closePaperPosition(candle.close);
            }
            
            // Update UI
            this.updateLiveChart(candle);
            this.updatePaperBalance();
        };
    }
};
```

---

## ğŸ“¦ Strategy Import/Export

### Export Strategy

```javascript
async function exportStrategy() {
    const strategy = {
        name: "My RSI Strategy",
        description: "RSI oversold/overbought with volume confirmation",
        version: "1.0.0",
        author: "User123",
        
        parameters: {
            rsi_period: 14,
            rsi_oversold: 30,
            rsi_overbought: 70,
            volume_threshold: 150
        },
        
        entry_conditions: [
            {indicator: "rsi", comparison: "lt", value: 30},
            {indicator: "volume", comparison: "gt", value: 150}
        ],
        
        exit_conditions: [
            {indicator: "rsi", comparison: "gt", value: 70}
        ],
        
        risk_management: {
            stop_loss: 2.0,
            take_profit: 4.0,
            risk_per_trade: 1.0,
            max_positions: 3
        },
        
        backtest_results: {
            sharpe_ratio: 1.85,
            win_rate: 65.5,
            total_trades: 42
        }
    };
    
    // Save to file
    const blob = new Blob([JSON.stringify(strategy, null, 2)], 
                          {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'my_strategy.json';
    a.click();
}
```

### Import Strategy

```javascript
async function importStrategy(file) {
    const text = await file.text();
    const strategy = JSON.parse(text);
    
    // Validate strategy
    if (!validateStrategy(strategy)) {
        throw new Error('Invalid strategy format');
    }
    
    // Load into builder
    loadStrategyIntoBuilder(strategy);
    
    // Run backtest
    const results = await testStrategy(strategy);
    
    return {strategy, results};
}
```

---

## ğŸ“ Advanced Features

### 1. Correlation Matrix

```javascript
// Ğ¢ĞµÑÑ‚ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾
// Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ¸Ñ… ĞºĞ¾Ñ€Ñ€ĞµĞ»ÑÑ†Ğ¸Ğ¸

{
    "strategies": ["elcaro", "rsibboi", "trend_following"],
    "correlation_matrix": [
        [1.00, 0.45, 0.62],  // elcaro
        [0.45, 1.00, 0.38],  // rsibboi
        [0.62, 0.38, 1.00]   // trend_following
    ],
    
    // ĞĞ¸Ğ·ĞºĞ°Ñ ĞºĞ¾Ñ€Ñ€ĞµĞ»ÑÑ†Ğ¸Ñ = Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ğ´Ğ¸Ğ²ĞµÑ€ÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
    "diversification_score": 0.72
}
```

### 2. Multi-Symbol Backtesting

```javascript
{
    "symbols": ["BTCUSDT", "ETHUSDT", "SOLUSDT"],
    "strategy": "elcaro",
    "results": {
        "BTCUSDT": {sharpe: 1.85, win_rate: 65.5},
        "ETHUSDT": {sharpe: 2.10, win_rate: 68.2},
        "SOLUSDT": {sharpe: 1.65, win_rate: 62.8}
    },
    "portfolio_sharpe": 2.25  // Diversified
}
```

### 3. Timeframe Analysis

```javascript
{
    "strategy": "trend_following",
    "timeframes": ["1m", "5m", "15m", "1h", "4h"],
    "results": {
        "1m": {sharpe: 1.20, trades: 520},
        "5m": {sharpe: 1.55, trades: 180},
        "15m": {sharpe: 1.85, trades: 85},   // Best
        "1h": {sharpe: 1.65, trades: 42},
        "4h": {sharpe: 1.40, trades: 18}
    }
}
```

---

## ğŸ”Œ WebSocket Integration

### Real-time Backtest Updates

```javascript
// Client-side
const ws = new WebSocket('/ws/backtest/12345');

ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    
    switch (data.type) {
        case 'progress':
            updateProgressBar(data.progress);
            break;
            
        case 'trade':
            addTradeToTable(data.trade);
            updateEquityCurve(data.equity);
            break;
            
        case 'complete':
            showResults(data.results);
            break;
            
        case 'error':
            showError(data.error);
            break;
    }
};

// Start backtest
ws.send(JSON.stringify({
    action: 'start_backtest',
    strategy_id: 'elcaro',
    symbol: 'BTCUSDT',
    timeframe: '1h'
}));
```

---

## ğŸ“ Best Practices

### 1. Data Quality
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 30 Ğ´Ğ½ĞµĞ¹)
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞ¹Ñ‚Ğµ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- Ğ£Ñ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ñ€Ğ¾ÑĞºĞ°Ğ»ÑŒĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ (slippage) Ğ¸ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸

### 2. Overfitting Prevention
- Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Walk-Forward Analysis
- Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ½Ğ° out-of-sample Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- ĞĞµ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ´ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´

### 3. Risk Management
- Risk per trade â‰¤ 1-2% Ğ¾Ñ‚ Ğ´ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ°
- Max drawdown â‰¤ 20%
- Stop loss Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½

### 4. Strategy Validation
- Win rate > 50% Ğ´Ğ»Ñ long-only
- Sharpe Ratio > 1.0
- Profit Factor > 1.5
- Max consecutive losses < 5

### 5. Monte Carlo Analysis
- Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞ¹Ñ‚Ğµ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· MC
- Probability of profit > 70%
- 95% VaR Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¸ĞµĞ¼Ğ»ĞµĞ¼

---

## ğŸš¨ Common Pitfalls

### âŒ Ğ˜Ğ·Ğ±ĞµĞ³Ğ°Ğ¹Ñ‚Ğµ:

1. **Curve Fitting** - Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ´ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ
2. **Look-Ahead Bias** - Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
3. **Survivorship Bias** - Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° "Ğ¶Ğ¸Ğ²Ñ‹Ñ…" Ğ¼Ğ¾Ğ½ĞµÑ‚Ğ°Ñ…
4. **Small Sample Size** - < 30 ÑĞ´ĞµĞ»Ğ¾Ğº Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾
5. **Ignoring Costs** - ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸ Ğ¸ Ğ¿Ñ€Ğ¾ÑĞºĞ°Ğ»ÑŒĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ
6. **Over-Optimization** - ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
7. **Single Timeframe** - Ñ‚ĞµÑÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¼ TF
8. **No Walk-Forward** - Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ½Ğ° overfitting

---

## ğŸ¯ Success Metrics

### ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:

```python
{
    "sharpe_ratio": > 1.0,
    "win_rate": > 50%,
    "profit_factor": > 1.5,
    "total_trades": > 30,
    "max_drawdown": < 20%,
    "monte_carlo_profit_prob": > 70%,
    "walk_forward_consistency": > 0.8
}
```

### Excellent Strategy:

```python
{
    "sharpe_ratio": > 2.0,
    "win_rate": > 60%,
    "profit_factor": > 2.0,
    "max_drawdown": < 15%,
    "monte_carlo_profit_prob": > 85%,
    "walk_forward_consistency": > 0.85
}
```

---

## ğŸ”— API Documentation

### Complete API Reference

```bash
# Swagger UI
https://YOUR-DOMAIN/api/docs

# ReDoc
https://YOUR-DOMAIN/api/redoc

# OpenAPI JSON
https://YOUR-DOMAIN/api/openapi.json
```

### Quick API Test

```bash
# Run simple backtest
curl -X POST https://YOUR-DOMAIN/api/backtest/run \
  -H "Content-Type: application/json" \
  -d '{
    "symbol": "BTCUSDT",
    "strategy": "elcaro",
    "timeframe": "1h",
    "days": 30,
    "initial_balance": 10000
  }'
```

---

## ğŸ¨ UI Components

### Style Guide

```css
/* ElCaro Design System Ğ´Ğ»Ñ Backtest */
:root {
    --accent-purple: #8b5cf6;
    --accent-green: #22c55e;
    --accent-red: #ef4444;
    --gradient-purple: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
    --gradient-green: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
}

/* Buttons */
.btn-primary {
    background: var(--gradient-purple);
    box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
}

/* Strategy Cards */
.strategy-card.selected {
    border-color: var(--accent-purple);
    background: rgba(139, 92, 246, 0.1);
}

/* Result Stats */
.stat-card.positive {
    color: var(--accent-green);
    background: var(--green-dim);
}
```

---

## ğŸ“š Related Modules

1. **[Terminal](/terminal)** - Real trading interface
2. **[Screener](/screener)** - Market scanner
3. **[Strategies](/strategies)** - Strategy library
4. **[Marketplace](/marketplace)** - Strategy marketplace
5. **[Dashboard](/dashboard)** - Portfolio overview

---

## ğŸ“ Learning Resources

### Tutorials:
1. [Backtest Quickstart](BACKTEST_QUICKSTART.md)
2. [Strategy Builder Guide](STRATEGY_BUILDER.md)
3. [Advanced Analytics](BACKTEST_ENHANCED_README.md)

### Examples:
- `webapp/static/js/backtest.js` - Main frontend logic
- `webapp/services/backtest_engine_v2.py` - Backend engine
- `webapp/services/strategy_builder.py` - Visual builder

---

## ğŸ‰ Summary

ElCaro Backtest Module - ÑÑ‚Ğ¾ **Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°** Ğ´Ğ»Ñ:
- âœ… Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹
- âœ… Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- âœ… ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
- âœ… ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ñ€Ğ¸ÑĞºĞ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Monte Carlo
- âœ… Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ¾Ñ‚ overfitting Ñ‡ĞµÑ€ĞµĞ· Walk-Forward
- âœ… Ğ ĞµĞ°Ğ»Ñ‚Ğ°Ğ¹Ğ¼ ÑĞ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸ Ğ² Live Mode
- âœ… Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ°/Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹

**Status:** âœ… Fully Operational  
**URL:** `https://dean-italic-maternity-instead.trycloudflare.com/backtest`  
**Documentation:** `/api/docs`  

---

*Last updated: December 24, 2025*  
*ElCaro Trading Platform v2.1.0*
