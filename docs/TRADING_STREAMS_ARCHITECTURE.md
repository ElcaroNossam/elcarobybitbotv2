# ğŸ”€ Trading Streams Architecture
# Lyxen Trading Platform - ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ²
# ================================================
# Ğ’ĞµÑ€ÑĞ¸Ñ: 1.0 | 20 ÑĞ½Ğ²Ğ°Ñ€Ñ 2026

---

## ğŸ“Š ĞĞ‘Ğ©ĞĞ¯ Ğ¡Ğ¥Ğ•ĞœĞ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER (Telegram ID)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                                         â”‚
           â–¼                                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      BYBIT (CEX)        â”‚                             â”‚   HYPERLIQUID (DEX)     â”‚
â”‚  exchange = 'bybit'     â”‚                             â”‚  exchange = 'hyperliquid'â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                         â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                             â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
     â”‚           â”‚                                             â”‚           â”‚
     â–¼           â–¼                                             â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DEMO   â”‚ â”‚  REAL   â”‚                                 â”‚ TESTNET  â”‚ â”‚ MAINNET  â”‚
â”‚ account â”‚ â”‚ account â”‚                                 â”‚ account  â”‚ â”‚ account  â”‚
â”‚ ='demo' â”‚ â”‚ ='real' â”‚                                 â”‚='testnet'â”‚ â”‚='mainnet'â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚           â”‚                                             â”‚           â”‚
     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â”‚                                                         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           5 Ğ¡Ğ¢Ğ ĞĞ¢Ğ•Ğ“Ğ˜Ğ™                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   OI    â”‚ â”‚ Scryptomera â”‚ â”‚ Scalper â”‚ â”‚ Lyxen  â”‚ â”‚  Fibonacci  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚                â”‚
                    â–¼                â–¼                â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ direction â”‚    â”‚ direction â”‚    â”‚ direction â”‚
             â”‚  = 'all'  â”‚    â”‚  = 'long' â”‚    â”‚ = 'short' â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¢ Ğ ĞĞ¡Ğ§ĞĞ¢ ĞŸĞĞ¢ĞĞšĞĞ’

### Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:
```
ĞŸĞĞ¢ĞĞšĞ˜ = Ğ‘Ğ¸Ñ€Ğ¶Ğ¸ Ã— ĞĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹ Ã— Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ã— ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
       = 2 Ã— 2 Ã— 5 Ã— 3
       = 60 Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ² Ğ½Ğ° ÑĞ·ĞµÑ€Ğ°
```

### Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:
- Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğ¾ ÑĞ·ĞµÑ€Ğ¾Ğ² Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ **1 Ğ±Ğ¸Ñ€Ğ¶Ñƒ** (Bybit Ğ˜Ğ›Ğ˜ HyperLiquid)
- Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ **1 Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚** (Demo Ğ˜Ğ›Ğ˜ Real)
- Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ **1-2 ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸**
- ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ `'all'` (Ğ½Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ÑÑÑ‚ Long/Short)

**Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ÑĞ·ĞµÑ€: 1 Ã— 1 Ã— 2 Ã— 1 = 2 Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ°**

---

## ğŸ—„ï¸ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ Ğ‘Ğ”

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: `user_strategy_settings` (SIMPLIFIED - Jan 2026)

```sql
PRIMARY KEY: (user_id, strategy, side)
```

> **âš ï¸ Ğ’ĞĞ–ĞĞ:** Ğ¡Ñ…ĞµĞ¼Ğ° ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ° Ğ² ÑĞ½Ğ²Ğ°Ñ€Ğµ 2026.  
> ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ¿Ğ¾ (user_id, strategy, side) â€” **ĞĞ• Ğ¿Ğ¾ Ğ±Ğ¸Ñ€Ğ¶Ğ°Ğ¼/Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°Ğ¼**.  
> ĞĞ´Ğ½Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ ĞºĞ¾ Ğ²ÑĞµĞ¼ Ğ±Ğ¸Ñ€Ğ¶Ğ°Ğ¼ Ğ¸ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ².

| ĞŸĞ¾Ğ»Ğµ | Ğ¢Ğ¸Ğ¿ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|-----|----------|
| **user_id** | BIGINT | Telegram ID |
| **strategy** | TEXT | 'oi', 'scryptomera', 'scalper', 'elcaro', 'fibonacci' |
| **side** | TEXT | 'long' Ğ¸Ğ»Ğ¸ 'short' |
| enabled | BOOLEAN | Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ° Ğ»Ğ¸ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ |
| **percent** | REAL | Entry % Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ |
| **sl_percent** | REAL | Stop-Loss % Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ |
| **tp_percent** | REAL | Take-Profit % Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ |
| leverage | INTEGER | ĞŸĞ»ĞµÑ‡Ğ¾ |
| use_atr | BOOLEAN | Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ATR trailing |
| atr_trigger_pct | REAL | Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ ATR trailing |
| atr_step_pct | REAL | Ğ¨Ğ°Ğ³ ATR trailing |
| order_type | TEXT | 'market', 'limit' |

### Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Side-Specific Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº:

```python
# ĞŸÑ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ LONG Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸:
settings = get_strategy_settings(user_id, strategy)
entry_pct = settings.get("long_percent")
sl_pct = settings.get("long_sl_percent")
tp_pct = settings.get("long_tp_percent")

# ĞŸÑ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ SHORT Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸:
entry_pct = settings.get("short_percent")
sl_pct = settings.get("short_sl_percent")
tp_pct = settings.get("short_tp_percent")
```

---

## ğŸ”„ ĞœĞĞ Ğ¨Ğ Ğ£Ğ¢Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ Ğ¡Ğ˜Ğ“ĞĞĞ›ĞĞ’

### ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´Ğ¸Ñ‚ ÑĞ¸Ğ³Ğ½Ğ°Ğ»:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ğ¡Ğ˜Ğ“ĞĞĞ›     â”‚
â”‚ strategy=OI  â”‚
â”‚ side=Buy     â”‚
â”‚ symbol=BTC   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ exchange_type ÑĞ·ĞµÑ€Ğ°                                  â”‚
â”‚     exchange = db.get_exchange_type(uid)  # 'bybit'              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ trading_mode ÑĞ·ĞµÑ€Ğ°                                   â”‚
â”‚     mode = db.get_trading_mode(uid)  # 'demo' / 'real' / 'both'  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ target accounts                                    â”‚
â”‚     if mode == 'both':                                           â”‚
â”‚         targets = ['demo', 'real']  # Ğ¸Ğ»Ğ¸ ['testnet', 'mainnet'] â”‚
â”‚     else:                                                         â”‚
â”‚         targets = [mode]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ target account:                                   â”‚
â”‚     # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞĞ”ĞĞ˜ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ±Ğ¸Ñ€Ğ¶/Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ² (SIMPLIFIED ÑÑ…ĞµĞ¼Ğ°)  â”‚
â”‚     settings = db.get_strategy_settings(uid, 'oi')               â”‚
â”‚     if settings.get('enabled'):                                   â”‚
â”‚         # side-specific Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸                                 â”‚
â”‚         entry_pct = settings.get('long_percent')  # Ğ´Ğ»Ñ Buy      â”‚
â”‚         open_position(...)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ™

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 1: ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ ÑĞ·ĞµÑ€ (2 Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ - long + short)
```
user_id: 123456
exchange: bybit
trading_mode: demo
strategy: OI (enabled)
```
**Ğ—Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ² user_strategy_settings: 2**
- (123456, 'oi', 'long')
- (123456, 'oi', 'short')

---

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 2: ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğ¹ ÑĞ·ĞµÑ€ (4 Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ - 2 ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ã— 2 ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹)
```
user_id: 789012
exchange: bybit
trading_mode: both (demo + real)
strategies: OI, Scryptomera (enabled)
```
**Ğ—Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ² user_strategy_settings: 4**
- (789012, 'oi', 'long')
- (789012, 'oi', 'short')
- (789012, 'scryptomera', 'long')
- (789012, 'scryptomera', 'short')

> **ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ:** ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ Ğº Ğ’Ğ¡Ğ•Ğœ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°Ğ¼ (demo + real).  
> ĞĞµÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ account_type!

---

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 3: ĞŸÑ€Ğ¾Ñ„Ğ¸ Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼Ğ¸ Long/Short Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
```
user_id: 456789
exchange: bybit
trading_mode: both
strategies: OI, Scryptomera
OI long: entry=3%, SL=25%, TP=20%
OI short: entry=5%, SL=30%, TP=25%
```
**Ğ—Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ² user_strategy_settings: 4** (2 ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ã— 2 ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹)
- (456789, 'oi', 'long') â†’ entry=3%, SL=25%, TP=20%
- (456789, 'oi', 'short') â†’ entry=5%, SL=30%, TP=25%
- (456789, 'scryptomera', 'long') â†’ entry=2%
- (456789, 'scryptomera', 'short') â†’ entry=1.5%

---

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 4: ĞœÑƒĞ»ÑŒÑ‚Ğ¸-Ğ±Ğ¸Ñ€Ğ¶Ğ° (Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞĞ”Ğ˜ĞĞĞšĞĞ’Ğ« Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ±Ğ¸Ñ€Ğ¶)
```
user_id: 111222
exchanges: bybit + hyperliquid
bybit: trading_mode=both (demo + real)
hyperliquid: testnet + mainnet
strategies: Ğ²ÑĞµ 5
```
**Ğ—Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ² user_strategy_settings: 10** (5 ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹ Ã— 2 ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹)
- (111222, 'oi', 'long'), (111222, 'oi', 'short')
- (111222, 'scryptomera', 'long'), (111222, 'scryptomera', 'short')
- ... Ğ¸ Ñ‚.Ğ´.

> **Ğ’Ğ°Ğ¶Ğ½Ğ¾:** ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ ĞºĞ¾ Ğ’Ğ¡Ğ•Ğœ Ğ±Ğ¸Ñ€Ğ¶Ğ°Ğ¼ Ğ¸ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°Ğ¼.
> ĞĞµÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ´Ğ»Ñ Bybit vs HyperLiquid!

---

## ğŸ¯ QUICK REFERENCE

### ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ (SIMPLIFIED ÑÑ…ĞµĞ¼Ğ°):
```python
from db import get_strategy_settings

# Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ user_id Ğ¸ strategy - exchange/account_type Ğ˜Ğ“ĞĞĞ Ğ˜Ğ Ğ£Ğ®Ğ¢Ğ¡Ğ¯
settings = get_strategy_settings(user_id=123456, strategy='oi')

# Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:
# {
#     'long_enabled': True,
#     'long_percent': 5.0,
#     'long_sl_percent': 30.0,
#     'long_tp_percent': 25.0,
#     'short_enabled': True,
#     'short_percent': 5.0,
#     'short_sl_percent': 30.0,
#     'short_tp_percent': 25.0,
# }
```

### ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½ÑƒÑ Ğ±Ğ¸Ñ€Ğ¶Ñƒ ÑĞ·ĞµÑ€Ğ°:
```python
from db import get_exchange_type, get_trading_mode

exchange = get_exchange_type(uid)      # 'bybit' | 'hyperliquid'
mode = get_trading_mode(uid)           # 'demo' | 'real' | 'both'
```

### ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ 'both':
```python
from db import _normalize_both_account_type

# 'both' â†’ 'demo' (Bybit) Ğ¸Ğ»Ğ¸ 'testnet' (HL)
acc = _normalize_both_account_type('both', exchange='bybit')  # â†’ 'demo'
acc = _normalize_both_account_type('both', exchange='hyperliquid')  # â†’ 'testnet'
```

### ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Side-Specific Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸:
```python
# Ğ”Ğ»Ñ LONG (side='Buy')
entry = settings.get('long_percent')
sl = settings.get('long_sl_percent')

# Ğ”Ğ»Ñ SHORT (side='Sell')
entry = settings.get('short_percent')
sl = settings.get('short_sl_percent')
```

---

## ğŸ”§ ĞĞ Ğ¥Ğ˜Ğ¢Ğ•ĞšĞ¢Ğ£Ğ Ğ ĞĞĞ¡Ğ¢Ğ ĞĞ•Ğš (Ğ¯Ğ½Ğ²Ğ°Ñ€ÑŒ 2026)

### Ğ£Ğ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½Ğ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° (SIMPLIFIED):

**Ğ‘Ñ‹Ğ»Ğ¾ (4D):** `(user_id, strategy, exchange, account_type)` - Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ±Ğ¸Ñ€Ğ¶Ğ¸/Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾ (3D):** `(user_id, strategy, side)` - Ğ¾Ğ´Ğ½Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ±Ğ¸Ñ€Ğ¶/Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ—ĞĞŸĞ˜Ğ¡Ğ¬ (set_strategy_setting)                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  ĞŸĞ¸ÑˆĞµÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ (long/short)                        â”‚
â”‚  ĞĞ´Ğ½Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ ĞºĞ¾ Ğ’Ğ¡Ğ•Ğœ Ğ±Ğ¸Ñ€Ğ¶Ğ°Ğ¼ Ğ¸ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°Ğ¼                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ§Ğ¢Ğ•ĞĞ˜Ğ• (get_strategy_settings)                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚  Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞĞ‘Ğ• ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ (long + short) Ğ¾Ğ´Ğ½Ğ¸Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼:                â”‚
â”‚                                                                         â”‚
â”‚  {                                                                      â”‚
â”‚      'long_enabled': True,                                             â”‚
â”‚      'long_percent': 5.0,                                              â”‚
â”‚      'long_sl_percent': 30.0,                                          â”‚
â”‚      'long_tp_percent': 25.0,                                          â”‚
â”‚      'short_enabled': True,                                            â”‚
â”‚      'short_percent': 5.0,                                             â”‚
â”‚      'short_sl_percent': 30.0,                                         â”‚
â”‚      'short_tp_percent': 25.0,                                         â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â”‚  Ğ•ÑĞ»Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ½ĞµÑ‚ â†’ SYSTEM DEFAULTS Ğ¸Ğ· coin_params.py                 â”‚
â”‚      _source = "system"                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:

```python
# Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºÑƒ Ğ´Ğ»Ñ LONG ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹
db.set_strategy_setting(uid, 'oi', 'long', percent=5.0, sl_percent=30.0)

# Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºÑƒ Ğ´Ğ»Ñ SHORT ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ (Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°Ñ‚ÑŒÑÑ!)
db.set_strategy_setting(uid, 'oi', 'short', percent=3.0, sl_percent=25.0)

# Ğ§Ğ¸Ñ‚Ğ°ÑÑ‚ÑÑ ĞĞ‘Ğ• ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ Ğ²Ğ¼ĞµÑÑ‚Ğµ
settings = db.get_strategy_settings(uid, 'oi')
print(settings['long_percent'])   # 5.0
print(settings['short_percent'])  # 3.0
```

### Ğ¡Ñ‚Ğ°Ñ€Ğ°Ñ vs ĞĞ¾Ğ²Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°:

| Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ | Ğ‘Ñ‹Ğ»Ğ¾ (4D Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ) | Ğ¡Ñ‚Ğ°Ğ»Ğ¾ (3D simplified) |
|----------|------------------------|------------------------|
| Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ SL=3% Ğ´Ğ»Ñ Long | 4 Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸: bybit-demo, bybit-real, hl-testnet, hl-mainnet | 1 Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ: (uid, oi, long) |
| Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ SL=5% Ğ´Ğ»Ñ Long | 4 UPDATE | 1 UPDATE |
| Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Long/Short | 8 Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ | 2 Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸: long + short |

### ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:

1. **ĞœĞµĞ½ÑŒÑˆĞµ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ² Ğ² Ğ‘Ğ”** - Ñ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ÑĞ·ĞµÑ€: 2 Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ (long+short) Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 20+
2. **ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ** - Ğ¾Ğ´Ğ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ²ĞµĞ·Ğ´Ğµ
3. **ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°** - Ğ½Ğµ Ğ½ÑƒĞ¶ĞµĞ½ ĞºĞ°ÑĞºĞ°Ğ´ fallback
4. **ĞŸÑ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ** - side-specific Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑÑ€Ğ°Ğ·Ñƒ Ğ²Ğ¸Ğ´Ğ½Ñ‹

---

## ğŸ“ˆ ĞœĞĞĞ˜Ğ¢ĞĞ Ğ˜ĞĞ“ ĞŸĞĞ¢ĞĞšĞĞ’

### SQL Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°:

```sql
-- Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ½Ğ° ÑĞ·ĞµÑ€Ğ° (2 ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ Ã— N ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹)
SELECT user_id, COUNT(*) as settings_count
FROM user_strategy_settings
WHERE enabled = true
GROUP BY user_id
ORDER BY settings_count DESC;

-- ĞšĞ°ĞºĞ¸Ğµ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ¿Ğ¾Ğ¿ÑƒĞ»ÑÑ€Ğ½Ñ‹
SELECT strategy, COUNT(DISTINCT user_id) as users
FROM user_strategy_settings
WHERE enabled = true
GROUP BY strategy
ORDER BY users DESC;

-- Ğ Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ°Ğ¼
SELECT strategy, side, COUNT(*) as count
FROM user_strategy_settings
WHERE enabled = true
GROUP BY strategy, side;

-- Ğ—Ğ°Ğ¿Ğ¸ÑĞ¸ Ñ per-account override
SELECT user_id, strategy, exchange, account_type
FROM user_strategy_settings
WHERE account_type NOT IN ('default');
```

---

*ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: 20 ÑĞ½Ğ²Ğ°Ñ€Ñ 2026*
*Ğ’ĞµÑ€ÑĞ¸Ñ: 1.1 - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ fallback Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ñ 'default'*
