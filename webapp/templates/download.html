<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Enliko Trading</title>
    <link rel="icon" href="/static/img/favicon.png" type="image/png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: #050505;
            color: #f0f0f0;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* Ambient glow */
        body::before {
            content: '';
            position: fixed;
            top: -40%; left: -20%;
            width: 80%; height: 80%;
            background: radial-gradient(circle, rgba(99,102,241,0.08) 0%, transparent 70%);
            pointer-events: none; z-index: 0;
        }
        body::after {
            content: '';
            position: fixed;
            bottom: -40%; right: -20%;
            width: 80%; height: 80%;
            background: radial-gradient(circle, rgba(168,85,247,0.06) 0%, transparent 70%);
            pointer-events: none; z-index: 0;
        }

        .container {
            position: relative; z-index: 1;
            max-width: 560px; width: 100%;
            margin: 0 auto;
            padding-top: 40px;
            padding-bottom: 40px;
        }

        /* Header */
        .header { text-align: center; margin-bottom: 32px; }
        .header-icon { font-size: 48px; margin-bottom: 8px; }
        h1 {
            font-size: 28px; font-weight: 700;
            background: linear-gradient(135deg, #f0f0f0, #a0a0b0);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .header-sub { color: #666; font-size: 13px; margin-top: 4px; }

        /* Glass card */
        .card {
            background: rgba(255,255,255,0.035);
            border: 1px solid rgba(255,255,255,0.07);
            border-radius: 20px;
            padding: 28px 24px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            margin-bottom: 16px;
        }

        /* HERO DOWNLOAD CARD */
        .hero { text-align: center; position: relative; overflow: hidden; }
        .hero::before {
            content: '';
            position: absolute; top: -80px; left: 50%; transform: translateX(-50%);
            width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(99,102,241,0.12) 0%, transparent 70%);
            pointer-events: none;
        }

        .platform-row {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-bottom: 20px;
        }
        .platform-badge {
            display: inline-flex; align-items: center; gap: 5px;
            background: rgba(76,175,80,0.12); border: 1px solid rgba(76,175,80,0.25);
            color: #4CAF50; padding: 5px 12px; border-radius: 20px;
            font-size: 11px; font-weight: 700; letter-spacing: 0.6px;
        }
        .version-badge {
            display: inline-flex; align-items: center; gap: 4px;
            background: rgba(99,102,241,0.12); border: 1px solid rgba(99,102,241,0.25);
            color: #818cf8; padding: 5px 12px; border-radius: 20px;
            font-size: 11px; font-weight: 700; letter-spacing: 0.4px;
        }

        .app-icon {
            width: 80px; height: 80px; border-radius: 22px;
            background: linear-gradient(135deg, #6366f1, #a855f7);
            display: flex; align-items: center; justify-content: center;
            font-size: 36px; margin: 0 auto 14px;
            box-shadow: 0 8px 32px rgba(99,102,241,0.3);
            position: relative;
        }
        .app-name { font-size: 22px; font-weight: 700; }

        .version-info {
            display: flex; align-items: center; justify-content: center;
            gap: 16px; margin: 8px 0 6px; flex-wrap: wrap;
        }
        .vi { color: #777; font-size: 12px; display: flex; align-items: center; gap: 4px; }
        .vi strong { color: #aaa; font-weight: 600; }

        .download-btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; padding: 16px 32px; margin-top: 18px;
            background: linear-gradient(135deg, #6366f1, #a855f7);
            color: white; font-size: 16px; font-weight: 700;
            border: none; border-radius: 14px; cursor: pointer;
            text-decoration: none; transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(99,102,241,0.35);
            letter-spacing: 0.3px; position: relative;
        }
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(99,102,241,0.5);
        }
        .download-btn:active { transform: translateY(0); }
        .download-btn svg { width: 20px; height: 20px; }

        .download-meta {
            color: #555; font-size: 11px; margin-top: 10px;
        }

        /* SPECS GRID */
        .specs-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr;
            gap: 10px; margin-top: 18px;
        }
        .spec {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px; padding: 12px 8px; text-align: center;
        }
        .spec-label { color: #555; font-size: 10px; text-transform: uppercase; letter-spacing: 0.7px; margin-bottom: 3px; }
        .spec-value { color: #ddd; font-size: 13px; font-weight: 600; }

        /* CHANGELOG */
        .changelog-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 16px;
        }
        .changelog-title { font-size: 16px; font-weight: 700; color: #ddd; }
        .changelog-count { color: #555; font-size: 12px; }

        .release {
            position: relative;
            padding-left: 20px;
            margin-bottom: 20px;
        }
        .release:last-child { margin-bottom: 0; }

        /* Timeline line */
        .release::before {
            content: '';
            position: absolute; left: 4px; top: 8px;
            width: 2px; height: calc(100% + 12px);
            background: rgba(255,255,255,0.06);
        }
        .release:last-child::before { display: none; }

        /* Timeline dot */
        .release::after {
            content: '';
            position: absolute; left: 0; top: 6px;
            width: 10px; height: 10px; border-radius: 50%;
            background: #6366f1; border: 2px solid #050505;
            box-shadow: 0 0 8px rgba(99,102,241,0.4);
        }

        .release-head {
            display: flex; align-items: center; gap: 8px;
            flex-wrap: wrap; margin-bottom: 8px;
        }
        .release-ver {
            font-size: 15px; font-weight: 700; color: #e0e0e0;
        }
        .release-type {
            font-size: 10px; font-weight: 700; padding: 2px 8px;
            border-radius: 6px; letter-spacing: 0.5px; text-transform: uppercase;
        }
        .release-type.major { background: rgba(99,102,241,0.15); color: #818cf8; }
        .release-type.minor { background: rgba(76,175,80,0.15); color: #66bb6a; }
        .release-type.patch { background: rgba(251,191,36,0.15); color: #fbbf24; }
        .release-type.hotfix { background: rgba(239,68,68,0.15); color: #ef4444; }

        .release-date { color: #555; font-size: 12px; }

        .release-title { color: #999; font-size: 13px; font-weight: 600; margin-bottom: 6px; }

        .release-changes {
            list-style: none; padding: 0;
        }
        .release-changes li {
            color: #888; font-size: 13px; line-height: 1.6;
            padding-left: 16px; position: relative;
        }
        .release-changes li::before {
            content: '\203A'; position: absolute; left: 0;
            color: #555; font-weight: 700;
        }

        /* INSTALL STEPS */
        .steps-title { font-size: 15px; font-weight: 600; color: #ccc; margin-bottom: 16px; }

        .step {
            display: flex; align-items: flex-start; gap: 12px;
            margin-bottom: 12px;
        }
        .step-num {
            flex-shrink: 0; width: 26px; height: 26px; border-radius: 50%;
            background: rgba(99,102,241,0.12); border: 1px solid rgba(99,102,241,0.25);
            color: #818cf8; font-size: 12px; font-weight: 700;
            display: flex; align-items: center; justify-content: center;
        }
        .step-text { color: #888; font-size: 13px; line-height: 1.5; padding-top: 2px; }
        .step-text strong { color: #bbb; }

        /* UPDATE CHECKER */
        .update-checker {
            display: flex; align-items: center; gap: 12px;
            background: rgba(99,102,241,0.06);
            border: 1px solid rgba(99,102,241,0.12);
            border-radius: 14px; padding: 14px 18px;
        }
        .update-checker-icon { font-size: 22px; }
        .update-checker-text { flex: 1; }
        .update-checker-title { font-size: 13px; font-weight: 600; color: #bbb; }
        .update-checker-sub { font-size: 11px; color: #666; margin-top: 2px; }
        .update-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: #4CAF50; box-shadow: 0 0 6px rgba(76,175,80,0.5);
            animation: pulse-dot 2s ease-in-out infinite;
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.3); }
        }

        /* WARNING */
        .warning {
            display: flex; align-items: flex-start; gap: 10px;
            background: rgba(251,191,36,0.07);
            border: 1px solid rgba(251,191,36,0.12);
            border-radius: 12px; padding: 13px 16px;
            margin-top: 16px;
        }
        .warning-icon { font-size: 16px; flex-shrink: 0; margin-top: 1px; }
        .warning-text { color: #ab9240; font-size: 12px; line-height: 1.5; }
        .warning-text strong { color: #c9a94e; }

        /* iOS */
        .ios-card { text-align: center; }
        .ios-btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            width: 100%; padding: 14px 24px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            color: #aaa; font-size: 14px; font-weight: 600;
            border-radius: 14px; cursor: default; text-decoration: none;
        }
        .ios-badge {
            background: rgba(99,102,241,0.15); color: #818cf8;
            font-size: 10px; padding: 2px 8px; border-radius: 6px; font-weight: 700;
        }
        .ios-info { color: #444; font-size: 11px; margin-top: 8px; }

        /* FOOTER */
        .footer {
            text-align: center; margin-top: 20px;
            color: #333; font-size: 11px;
        }
        .footer a { color: #555; text-decoration: none; }
        .footer a:hover { color: #818cf8; }

        /* SKELETON LOADING */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.04) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.04) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* NEW TAG */
        .new-tag {
            display: inline-flex; align-items: center;
            background: rgba(76,175,80,0.15); color: #66bb6a;
            font-size: 9px; font-weight: 800; padding: 2px 7px;
            border-radius: 4px; letter-spacing: 0.8px;
            animation: new-glow 2s ease-in-out infinite;
        }
        @keyframes new-glow {
            0%, 100% { box-shadow: 0 0 4px rgba(76,175,80,0.2); }
            50% { box-shadow: 0 0 10px rgba(76,175,80,0.4); }
        }

        /* AGO badge */
        .ago-badge {
            display: inline-flex; align-items: center;
            background: rgba(168,85,247,0.12); color: #c084fc;
            font-size: 10px; font-weight: 600; padding: 2px 8px;
            border-radius: 6px;
        }

        @media (max-width: 480px) {
            .container { padding-top: 20px; }
            .card { padding: 22px 18px; }
            h1 { font-size: 24px; }
            .download-btn { padding: 14px 24px; font-size: 15px; }
            .specs-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-icon">üìä</div>
            <h1>Enliko Trading</h1>
            <p class="header-sub">Professional Algorithmic Trading Platform</p>
        </div>

        <!-- HERO DOWNLOAD CARD -->
        <div class="card hero" id="heroCard">
            <div class="platform-row">
                <span class="platform-badge">ü§ñ ANDROID</span>
                <span class="version-badge" id="versionBadge">v‚Äî</span>
            </div>

            <div class="app-icon">üìà</div>
            <div class="app-name">Enliko Trading</div>

            <div class="version-info" id="versionInfo">
                <span class="vi">üì¶ <strong id="viSize">‚Äî</strong></span>
                <span class="vi">üìÖ <strong id="viDate">‚Äî</strong></span>
                <span class="vi">üîñ Build <strong id="viBuild">‚Äî</strong></span>
            </div>

            <a href="/static/downloads/EnlikoTrading.apk" class="download-btn" id="downloadBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                <span id="btnText">Download APK</span>
            </a>

            <p class="download-meta" id="downloadMeta">Signed release ¬∑ Universal architecture</p>

            <div class="specs-grid" id="specsGrid">
                <div class="spec">
                    <div class="spec-label">Min Android</div>
                    <div class="spec-value" id="specMin">8.0</div>
                </div>
                <div class="spec">
                    <div class="spec-label">Target SDK</div>
                    <div class="spec-value">Android 15</div>
                </div>
                <div class="spec">
                    <div class="spec-label">Package</div>
                    <div class="spec-value" style="font-size:11px">io.enliko.trading</div>
                </div>
            </div>
        </div>

        <!-- UPDATE CHECKER -->
        <div class="card" id="updateCard" style="padding:0;">
            <div class="update-checker">
                <span class="update-checker-icon">üîÑ</span>
                <div class="update-checker-text">
                    <div class="update-checker-title" id="updateTitle">Checking for updates...</div>
                    <div class="update-checker-sub" id="updateSub">Comparing with latest version</div>
                </div>
                <div class="update-dot" id="updateDot"></div>
            </div>
        </div>

        <!-- CHANGELOG -->
        <div class="card" id="changelogCard">
            <div class="changelog-header">
                <span class="changelog-title">üìã Changelog</span>
                <span class="changelog-count" id="changelogCount"></span>
            </div>
            <div id="changelogList">
                <div style="height:60px" class="skeleton"></div>
            </div>
        </div>

        <!-- INSTALL STEPS -->
        <div class="card">
            <div class="steps-title">üì≤ Installation</div>
            <div class="step">
                <div class="step-num">1</div>
                <div class="step-text">Tap <strong>Download APK</strong> above</div>
            </div>
            <div class="step">
                <div class="step-num">2</div>
                <div class="step-text">If prompted, go to <strong>Settings ‚Üí Install unknown apps</strong> and allow your browser</div>
            </div>
            <div class="step">
                <div class="step-num">3</div>
                <div class="step-text">Tap <strong>Install</strong> ‚Äî if updating, your data is preserved</div>
            </div>
            <div class="step">
                <div class="step-num">4</div>
                <div class="step-text">Open the app and log in with <strong>Enliko</strong> credentials</div>
            </div>

            <div class="warning">
                <span class="warning-icon">‚ö†Ô∏è</span>
                <div class="warning-text">
                    This is a <strong>beta build</strong> for testers. Report bugs via Telegram.
                </div>
            </div>
        </div>

        <!-- iOS -->
        <div class="card ios-card" id="iosCard">
            <div class="ios-btn">
                üçé iOS ‚Äî TestFlight
                <span class="ios-badge" id="iosBadge">BUILD ‚Äî</span>
            </div>
            <p class="ios-info" id="iosInfo">Contact the team for TestFlight invite</p>
        </div>

        <!-- Footer -->
        <div class="footer">
            <a href="https://enliko.com">enliko.com</a> ¬∑
            <a href="https://enliko.com/terminal">Terminal</a> ¬∑
            <a href="https://enliko.com/pricing">Pricing</a>
        </div>
    </div>

    <script>
    (function() {
        var $ = function(id) { return document.getElementById(id); };

        fetch('/api/app/version?t=' + Date.now())
            .then(function(r) { return r.json(); })
            .then(function(data) {
                renderHero(data.latest);
                renderChangelog(data.changelog);
                renderUpdateChecker(data.latest);
                renderIos(data.ios);
            })
            .catch(function() {
                $('updateTitle').textContent = 'Version info unavailable';
                $('updateSub').textContent = 'Download the APK directly';
                $('updateDot').style.background = '#555';
                $('changelogList').innerHTML = '<p style="color:#555;font-size:13px">Could not load changelog</p>';
            });

        function renderHero(latest) {
            $('versionBadge').textContent = 'v' + latest.version;
            $('viSize').textContent = latest.size;
            $('viDate').textContent = formatDate(latest.buildDate);
            $('viBuild').textContent = latest.versionCode;
            $('downloadMeta').textContent =
                'Signed release ¬∑ Min Android ' + latest.minAndroid + ' ¬∑ Universal';
        }

        function renderChangelog(changelog) {
            $('changelogCount').textContent = changelog.length + ' release' + (changelog.length !== 1 ? 's' : '');
            var html = '';
            for (var i = 0; i < changelog.length; i++) {
                var rel = changelog[i];
                var isLatest = (i === 0);
                var ago = timeAgo(rel.date);
                html += '<div class="release">';
                html += '<div class="release-head">';
                html += '<span class="release-ver">v' + rel.version + '</span>';
                html += '<span class="release-type ' + rel.type + '">' + rel.type + '</span>';
                if (isLatest) html += '<span class="new-tag">NEW</span>';
                html += '<span class="ago-badge">' + ago + '</span>';
                html += '</div>';
                if (rel.title) {
                    html += '<div class="release-title">' + rel.title + '</div>';
                }
                html += '<ul class="release-changes">';
                for (var j = 0; j < rel.changes.length; j++) {
                    html += '<li>' + rel.changes[j] + '</li>';
                }
                html += '</ul></div>';
            }
            $('changelogList').innerHTML = html;
        }

        function renderUpdateChecker(latest) {
            var seenVersion = localStorage.getItem('enliko_apk_version');
            var isNew = !seenVersion || seenVersion !== latest.version;

            if (isNew) {
                $('updateTitle').textContent = 'üÜï New version available!';
                $('updateSub').textContent = 'v' + latest.version + ' ¬∑ ' + formatDate(latest.buildDate);
                $('updateDot').style.background = '#6366f1';
                $('updateDot').style.boxShadow = '0 0 6px rgba(99,102,241,0.5)';
            } else {
                $('updateTitle').textContent = '‚úÖ You have the latest version';
                $('updateSub').textContent = 'v' + latest.version + ' ¬∑ Up to date';
                $('updateDot').style.background = '#4CAF50';
            }
        }

        function renderIos(ios) {
            if (ios) {
                $('iosBadge').textContent = 'BUILD ' + ios.build;
                $('iosInfo').textContent = 'v' + ios.version + ' ¬∑ Contact the team for TestFlight invite';
            }
        }

        var dlBtn = $('downloadBtn');
        if (dlBtn) {
            dlBtn.addEventListener('click', function() {
                var latest = $('versionBadge').textContent.replace('v', '');
                if (latest && latest !== '‚Äî') {
                    localStorage.setItem('enliko_apk_version', latest);
                }
                var btn = $('btnText');
                btn.textContent = '‚¨áÔ∏è Downloading...';
                setTimeout(function() {
                    btn.textContent = '‚úÖ Downloaded!';
                    $('updateTitle').textContent = '‚úÖ You have the latest version';
                    $('updateSub').textContent = 'v' + latest + ' ¬∑ Up to date';
                    $('updateDot').style.background = '#4CAF50';
                    setTimeout(function() { btn.textContent = 'Download APK'; }, 4000);
                }, 2000);
            });
        }

        function formatDate(dateStr) {
            if (!dateStr) return '‚Äî';
            var d = new Date(dateStr + 'T00:00:00');
            var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            return months[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
        }

        function timeAgo(dateStr) {
            if (!dateStr) return '';
            var now = new Date();
            var then = new Date(dateStr + 'T00:00:00');
            var diffMs = now - then;
            var diffDays = Math.floor(diffMs / 86400000);
            if (diffDays === 0) return 'today';
            if (diffDays === 1) return 'yesterday';
            if (diffDays < 7) return diffDays + 'd ago';
            if (diffDays < 30) return Math.floor(diffDays / 7) + 'w ago';
            if (diffDays < 365) return Math.floor(diffDays / 30) + 'mo ago';
            return Math.floor(diffDays / 365) + 'y ago';
        }
    })();
    </script>
</body>
</html>
